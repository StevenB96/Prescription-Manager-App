{% extends "oauth_service/base.html" %}

{% block title %}Manage Tokens & Codes{% endblock %}

{% block content %}
<style>
    .item-list { list-style: none; padding: 0; }
    .item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 10px; }
    .item-info { max-width: 70%; }
    .item-type { font-weight: bold; text-transform: uppercase; margin-bottom: 5px; }
    .action-btn { padding: 8px 12px; font-size: 0.9em; border-radius: 6px; }
    .btn-danger { background-color: #e74c3c; color: #fff; border: none; }
    .btn-success { background-color: #2ecc71; color: #fff; border: none; }
    .no-items { text-align: center; color: #777; padding: 20px; }
</style>

<h1>Manage Tokens & Codes</h1>
<p style="text-align: center;">You can revoke tokens or exchange codes below.</p>

{% if items %}
    <ul class="item-list">
        {% for item in items %}
            <li class="item">
                <div class="item-info">
                    <div class="item-type">{{ item.type }}</div>
                    <div><strong>Client ID:</strong> {{ item.client_id }}</div>
                    {% if item.type == "token" %}
                        <div><strong>Access Token:</strong> {{ item.access_token }}</div>
                        <div><strong>Refresh Token:</strong> {{ item.refresh_token }}</div>
                        <div><strong>Expires At:</strong> {{ item.expires_at }}</div>
                    {% else %}
                        <div><strong>Code:</strong> {{ item.code }}</div>
                        <div><strong>Redirect URI:</strong> {{ item.redirect_uri }}</div>
                        <div><strong>Expires At:</strong> {{ item.expires_at }}</div>
                    {% endif %}
                    <div><strong>Scope:</strong> {{ item.scope }}</div>
                    <div><strong>Created At:</strong> {{ item.created_at }}</div>
                </div>

                <div class="item-action">
                    {% if item.type == "token" %}
                        <!-- Revoke Token -->
                        <form method="post" action="{% url 'oauth_service:revoke-token' %}"
                              onsubmit="return confirm('Revoke this token?');">
                            {% csrf_token %}
                            <input 
                                type="hidden" 
                                name="client_id" 
                                value="{{ item.client_id }}"
                            >
                            <input 
                                type="hidden" 
                                name="client_secret" 
                                value="{{ item.client_secret }}"
                            >
                            <input 
                                type="hidden" 
                                name="token" 
                                value="{{ item.refresh_token }}"
                            >
                            <button type="submit" class="action-btn btn-danger">Revoke Access</button>
                        </form>
                    {% else %}
                        <!-- Exchange Code for Token -->
                        <form method="post" action="{% url 'oauth_service:token' %}">
                            {% csrf_token %}
                            <input 
                                type="hidden" 
                                name="grant_type" 
                                value="authorization_code"
                            >
                            <input 
                                type="hidden" 
                                name="client_id" 
                                value="{{ item.client_id }}"
                            >
                            <input 
                                type="hidden" 
                                name="client_secret" 
                                value="{{ item.client_secret }}"
                            >
                            <input 
                                type="hidden" 
                                name="code" 
                                value="{{ item.code }}"
                            >
                            <input 
                                type="hidden" 
                                name="redirect_uri" 
                                value="{{ item.redirect_uri }}"
                            >
                            <button type="submit" class="action-btn btn-success">Grant Access</button>
                        </form>
                    {% endif %}
                </div>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p class="no-items">You donâ€™t have any tokens or codes.</p>
{% endif %}

{% endblock %}
