{% extends "oauth_service/base.html" %}

{% block title %}Manage Tokens & Codes{% endblock %}

{% block content %}
<style>
    .item-list { list-style: none; padding: 0; }
    .item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 10px; }
    .item-info { max-width: 70%; }
    .item-type { font-weight: bold; text-transform: uppercase; margin-bottom: 5px; }
    .action-btn { padding: 8px 12px; font-size: 0.9em; border-radius: 6px; cursor: pointer; }
    .btn-danger { background-color: #e74c3c; color: #fff; border: none; }
    .btn-success { background-color: #2ecc71; color: #fff; border: none; }
    .no-items { text-align: center; color: #777; padding: 20px; }
    .errorlist { color: #e74c3c; margin: 5px 0 0 0; list-style: none; padding: 0; }
</style>

<h1>Manage Tokens & Codes</h1>
<p style="text-align: center;">You can revoke tokens or exchange codes below.</p>
<p style="text-align: center; color: #e67e22; font-weight: bold;">
    ⚠️ Note: Granting or revoking a code or token will update or delete your current token in this session.
</p>

{% if forms %}
    <ul class="item-list">
        {% for form in forms %}
            {% if form.form_type == 'token' %}
                <!-- Revoke token form -->
                <li class="item">
                    <div class="item-info">
                        <div class="item-type">Token</div>
                        <div><strong>Client ID:</strong> {{ form.initial.client_id }}</div>
                        <div><strong>Access Token:</strong> {{ form.initial.token }}</div>
                    </div>
                    <div class="item-action">
                        <form method="post" action="{% url 'oauth_service:revoke-token' %}"
                              onsubmit="return confirm('Revoke this token? This will delete it from your session.');">
                            {% csrf_token %}
                            {{ form.as_p }}
                            <button type="submit" class="action-btn btn-danger">Revoke Access</button>
                            {% if form.errors %}
                                <ul class="errorlist">
                                    {% for field, errors in form.errors.items %}
                                        {% for error in errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </form>
                    </div>
                </li>

            {% elif form.form_type == 'code' %}
                <!-- Access grant form -->
                <li class="item">
                    <div class="item-info">
                        <div class="item-type">Code</div>
                        <div><strong>Client ID:</strong> {{ form.initial.client_id }}</div>
                        <div><strong>Code:</strong> {{ form.initial.code }}</div>
                        <div><strong>Redirect URI:</strong> {{ form.initial.redirect_uri }}</div>
                    </div>
                    <div class="item-action">
                        <form method="post" action="{% url 'oauth_service:token' %}"
                              onsubmit="return confirm('Granting this access will set a new token in your session. Continue?');">
                            {% csrf_token %}
                            {{ form.as_p }}
                            <button type="submit" class="action-btn btn-success">Grant Access</button>
                            {% if form.errors %}
                                <ul class="errorlist">
                                    {% for field, errors in form.errors.items %}
                                        {% for error in errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </form>
                    </div>
                </li>
            {% endif %}
        {% endfor %}
    </ul>
{% else %}
    <p class="no-items">You don’t have any tokens or codes.</p>
{% endif %}

{% endblock %}
