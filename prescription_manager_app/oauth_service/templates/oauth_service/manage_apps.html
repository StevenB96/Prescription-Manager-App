{% extends "oauth_service/base.html" %}

{% block title %}Manage Connected Apps{% endblock %}

{% block content %}
    <style>
        .app-list { list-style: none; padding: 0; }
        .app-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 10px; }
        .app-name { font-weight: bold; }
        .revoke-btn { padding: 8px 12px; font-size: 0.9em; }
        .no-apps { text-align: center; color: #777; padding: 20px; }
    </style>

    <h1>Manage Connected Apps</h1>
    <p style="text-align: center;">You have granted the following applications access to your account. You can revoke their access at any time.</p>

    {% if clients %}
        <ul class="app-list">
            {% for client in clients %}
                <li class="app-item">
                    <div class="app-info">
                        <span class="app-name">{{ client.client_name }}</span>
                        {% if client.scopes %}
                            <ul class="permissions">
                                {% for s in client.scopes %}
                                    <li>{{ s }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    <form 
                        method="post" 
                        action="{% url 'oauth_service:deauthorise-client' %}" 
                        onsubmit="return confirm('Are you sure you want to revoke all access for {{ client.client_id }}?');">
                        {% csrf_token %}
                        <input 
                            type="hidden" 
                            name="client_id" 
                            value="{{ client.client_id }}"
                        >
                        <button type="submit" class="btn-danger revoke-btn">Revoke Access</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="no-apps">You have not authorised any applications.</p>
    {% endif %}

{% endblock %}